---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import Button from "../ui/Button.astro";

const siteData = await getCollection("siteCollection");
const siteInfo = siteData[0].data;
const offers = siteInfo.footerLatestOffers;
---

<!-- Auto Popup Modal for Latest Offer -->
<dialog id="auto_offer_popup" class="modal">
  <div class="modal-box">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
    </form>
    <h3 class="font-bold text-lg">ðŸŽ‰ Latest Offer!</h3>
    <div class="py-4">
      <Image
        src={offers.offerImg}
        alt={offers.title || "Latest Offer"}
        title={offers.title || "Latest Offer"}
        width={600}
        height={400}
        class="w-full h-auto object-contain rounded-lg mb-4"
      />
      {offers.subtitle && <p class="text-center">{offers.subtitle}</p>}
    </div>
    <div class="modal-action">
      <Button href={offers.btnLink} variant="primary" title="View Offers">
        View All Offers
      </Button>
      <form method="dialog">
        <button class="btn">Close</button>
      </form>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<script>
  // Check if popup has been shown this session
  const popupShown = sessionStorage.getItem('offerPopupShown');

  if (!popupShown) {
    // Show popup after 6 seconds
    setTimeout(() => {
      const popup = document.getElementById('auto_offer_popup') as HTMLDialogElement;
      if (popup) {
        popup.showModal();
        // Mark as shown for this session
        sessionStorage.setItem('offerPopupShown', 'true');
      }
    }, 6000);
  }
</script>